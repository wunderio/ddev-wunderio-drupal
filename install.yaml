name: ddev-drupal
ddev_version_constraint: ">= v1.23.0"

# Files copied into the project root preserving paths
project_files:
  - dist/.ddev/config.wunderio.yaml
  - dist/.ddev/commands/
  - dist/.ddev/wunderio/
  - dist/drush/sites/local.site.yml

pre_install_actions:
  - |
    #ddev-description: Checking DDEV environment
    if [ -z "${DDEV_APPROOT+x}" ]; then
      echo "Error: DDEV version is too old or not detected (missing DDEV_APPROOT). Please update DDEV."
      exit 1
    fi

post_install_actions:
  - |
    #ddev-description: Finalizing Wunderio DDEV Drupal installation
    echo "Wunderio DDEV Drupal installed. Managed files are marked with #ddev-generated."
    echo "Custom scripts can be added to .ddev/wunderio/custom/ and will be preserved."
  - |
    #ddev-description: Updating GrumPHP configuration (non-fatal)
    #ddev-warning-exit-code: 1
    bash .ddev/wunderio/core/scripts/update-grumphp-command.sh || true

removal_actions:
  - |
    #ddev-description: Cleaning up Wunderio DDEV Drupal managed files
    echo "Removing Wunderio DDEV Drupal managed files (custom overrides preserved)."

yaml_read_files:
  .gitignore: |
    # Wunderio DDEV Drupal managed files
    .ddev/wunderio/core
    .ddev/commands/*/wunderio-core-*

